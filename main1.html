<html>
<head>
<title>Processing.js examples - Chaos Theory game</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<style type="text/css">
<!--

body {
  font-family: verdana, geneva, arial, helvetica, sans-serif; 
  font-size: 11px; 
  background-color: #a9ac99;
}

p {
	text-align: justify;
	padding: 0 1em;
}

#about {
	float:left;
	-moz-border-radius: 10px;
	background-color: #fdfdfa;
	min-height: 400px;
	margin-left: 2em;
	width: 200px;
	border: 1px solid #999;
}

#footer {
	margin-top: 2em;
	-moz-border-radius: 10px;
	background-color: #fdfdfa;
	border: 1px solid #999;
}

#processing {
	margin-left: 10px;
	padding-left: 25px;
	background: url('processingico.png') left center no-repeat;
}

#about h1 {
	color: #a9ac99;
	font: 2em Georgia, 'Times New Roman', Times, serif;
	text-align: center;
}

#about h2, #about h3 {
	text-align: center;
	color: #777;
	font-size: 1.2em;
}

#content {

	float:left;
	margin: 1em 0 0 1em;
}

ul {
	list-style: none;
	margin: 0;
	padding: 0;
}

ul span {
	font-weight: bold;
}

ul li {
	line-height: 1.1em;
}

a, a:hover, a:visited, a:active {
	color: #333333;
	text-decoration: none;
	font-weight: bold;
}
a:hover {
	text-decoration: underline;
}
-->
</style>
<script type="text/javascript" src="processing/processing-0.9.1.js"></script>
<script type="text/javascript" src="processing/initprocessing.js"></script>

<script type="application/processing" targetCanvas="processingcanvas">

Bolinhas bolinhas;
Explosions explosions;

int ballslaunched = 0;
int ballsdestroyed = 0;

int frameCount=1;

ArrayList particles = new ArrayList();

PFont font;
void setup() {
  size(720, 500);
//  smooth();
  font = loadFont("Tahoma"); 
  textFont(font, 32);
  bolinhas = new Bolinhas();
  explosions = new Explosions();
  frameRate(30);
  rectMode(CORNERS);
  
	
}



void draw() {
  //background(60,60,120);
  background(51);
  fill(255,180);
  text(ballsdestroyed + "/" + ballslaunched, 10,30);

/*  explosions.drawAll();
  explosions.checkCollisions(bolinhas);
  bolinhas.drawAll();
  bolinhas.cycle();
  explosions.cycle(); */
  
  bolinhas.cycle();
  explosions.cycle();
  explosions.checkCollisions(bolinhas);
  explosions.drawAll();
  bolinhas.drawAll();

  if ((frameCount < 201) && ((frameCount % 8)==0)) {
      //for (int i = 3; i > 0; i--) {
        bolinhas.addRandomBolinha();
		bolinhas.addRandomBolinha();
		bolinhas.addRandomBolinha();
      //}
  }
  frameCount++;
}

void mousePressed() {
  if (mouseButton == 1) {
    explosions.addExplosion(mouseX,mouseY);
  } else {
    for (int i = 10; i > 0; i--) {
      bolinhas.addRandomBolinha();
    }
  }
}

void keyPressed() {
  if (key == 'r' || key == 'R') {
    ballslaunched = 0;
    ballsdestroyed = 0;
    bolinhas.reset();
    explosions.reset();
    frameCount = 1;
  } else if (key == 'l' || key == 'L') {
    //if ((mouseX > 0) && (mouseX < width) && (mouseY > 0) && (mouseY < height)) {
      float speed = random(-15,-5);
      float accel = 0.5*speed*speed/(height-mouseY+10);
      bolinhas.addBolinha(new sParticle(mouseX, height + 10, speed, accel));
   // }
  } else if (key == 'c' || key == 'C') {
    ballslaunched = 0;
    ballsdestroyed = 0;
    bolinhas.reset();
    explosions.reset();
    frameCount = 201;
  }  
 }


/***************/

class Bolinhas extends ParticleSystem {
  
   Bolinhas() {
    super(0);
  }
  
   Bolinhas(int particlesnum) {
    while (particlesnum-- > 0) {
      particles.add(new sParticle(int(random(0,width)), int(random(height+5,height+50)), random(-15,-7), random(0.1,0.4)));
      ballslaunched++;
    }
  }
    
  void addRandomBolinha() {
    float speed = random(-15,-5);
    float accel = 0.5*speed*speed/(random(180,420)); // altura min e max
    particles.add(new sParticle(int(random(0,width)), int(random(height+5,height+50)), speed, accel));
    ballslaunched++;
  }
  
  void addBolinha(Particle p) {
    particles.add(p);
    ballslaunched++;
  }
}



class Explosion extends Particle {

   int x;
   int y;

   int maxradius = 90;
   float inc = 10;
   float radius = 2;
   float biggerradius = 2;

  Explosion(int x, int y) {
    this.x = x;
    this.y = y;
  }

  void update() {
    biggerradius += inc;
    radius = constrain(biggerradius, -10, maxradius);
    if (biggerradius >= 300) {
      inc = -3;
      biggerradius = 90;
    }
  }

  boolean isDead() {
    return (radius < 0);
  }
  
  float getRadius() {
    return radius;
  }
  
   int getX() {
    return x;
  }
  
   int getY() {
    return y;
  }

  void drawSelf() {
    fill(255,0,0,100);
    ellipse(x,y,int(radius),int(radius));
    ellipse(x,y,int(radius*0.9),int(radius*0.9));
    ellipse(x,y,int(radius*0.8),int(radius*0.8));
    ellipse(x,y,int(radius*0.5),int(radius*0.5));
  }

 //  void kill() { }
}

/*********************/

class Explosions extends ParticleSystem {

   void addExplosion(int x, int y) {
    if (y < height + 30) {
      particles.add(new Explosion(x,y));
    }
  }
  
   void checkCollisions(Bolinhas bolinhas) {
    
    int i = particles.size();
    int b;
    
    int bx,by,ex,ey;
    float er;
    Particle p;
     Explosion e;
    
    while (i-- > 0) {
      b = bolinhas.size();
      e = (Explosion) particles.get(i);
      ex = e.getX();
      ey = e.getY();
      er = e.getRadius() / 2;
      while (b-- > 0) {
        
         p = (Particle) bolinhas.get(b);
         bx = p.getX();
         by = p.getY();
         
         

//    if ( sqrt( (ex-bx)*(ex-bx) + (ey-by)*(ey-by)) < er ) {
    if (dist(ex,ey,bx,by) < er) {
        addExplosion(bx,by);
        //  p.drawSelf();
        ballsdestroyed++;
        bolinhas.removeParticle(b);
        }
      }
    }
  }
  
}

/*************/

class ParticleSystem {

   particles = new ArrayList();

   void cycle() {
	int i = particles.size();
    Particle p;
    while (i-- > 0) {
      p = (Particle) particles.get(i);
      p.update();
      if (p.isDead()) {
        particles.remove(i);
      }
    }

	/*void cycle() {
		var i;
		Particle p;
		for (i = 0; i < particles.size(); i++) {
			p = (Particle) particles.get(i);
			p.update();
			if (p.isDead()) {
				particles.remove(i);
			}
		}
	}*/

  }
  
   void drawAll() {
    int i = particles.size();
    Particle p;
    while (i-- > 0) {
      p = (Particle)particles.get(i);
      p.drawSelf();
    }
  }
  
   int size() {
    return particles.size();
  }
  
   Object get(int i) {
    try {return particles.get(i); } catch (Exception e) { return null;}
  }
  
  void addParticle(Particle p){
    particles.add(p);
  }
  
  void removeParticle(int i) {
    particles.remove(i);
  }

  void reset() {
    particles = new ArrayList();
  }  
}

/****************/



class Particle {
   void update() { }
   void drawSelf() { }
   boolean isDead() { }
   int getX() { }
   int getY() { }
  
}

class sParticle extends Particle {
  
   int x;
   int y;
   float fy;
   float speed;
   float accel;
   int radius = 10;//BOLINHA_RADIUS;
//   boolean killed = false;
  
   //int[] oldy = new int[5];
  
  sParticle(int x, int y, float speed, float accel) {
    this.x = x;
    this.y = y;
    this.fy = float(y);
    this.speed = speed;
    this.accel = accel;
    //oldy[0]=oldy[1]=oldy[2]=oldy[3]=oldy[4]=y;
  }
  
  void update() {
    fy += speed;
    if (y != int(fy)) {
      y=int(fy);
      //adds new value to old pos array
      //for (int i=0;i<4;i++){
      //  oldy[i]=oldy[i+1];
      //}
      //oldy[4]=y;
    }
	y=fy;
    speed += accel;
  }
  
  boolean isDead() {
//    return (killed) || (y > height + 50);
    return (this.y > height + 50) ;
  }
  
  void drawSelf() {

    noStroke();
    /*fill(255, 30);
    ellipse(x,oldy[0], radius, radius);
    fill(255, 60);
    ellipse(x,oldy[1], radius, radius);
    fill(255, 90);
    ellipse(x,oldy[2], radius, radius);
    fill(255, 120);
    ellipse(x,oldy[3], radius, radius);
    fill(255, 150);
    ellipse(x,oldy[4], radius, radius);*/
    fill(255, 255);
    ellipse(x,y, radius, radius);
  }
  
   int getX() {
    return x;
  }
  
   int getY() {
    return y;
  }
  
 /*  void kill() {
    killed = true;
  }*/
  
}
</script>
</head>
<body>
<div id="content">
<div>
<canvas id="processingcanvas" width="720" height="500">
</div>
<div id="footer">
<p id="processing">
<!-- <img src="processingico.png" alt="processing.org" width="16" height="16">--> Built with <a href="http://processing.org" title="Processing.org">Processing</a> and <a href="http://ejohn.org/blog/processingjs/" title="Processing.js">Processing.js</a>
</p>
<p>
Felipe Gomes 2006 - 2008 -- <a href="http://felipc.com" title="felipc.com">felipc.com</a>
</div>
</div>

<div id="about">
<h1>chaos theory</h1>

<h2>Controls</h2>
	<ul>
		<li><span>left click</span>: generate explosion</li>
		<li><span>right click</span>: launch +10 balls</li>
		<li><span>C</span>: clear screen and counters</li>
		<li><span>R</span>: restart game</li>
		<li><span>L</span>: launch ball to mouse's position</li>
	</ul>

<h2>Instructions</h2>
	<p>When the game starts, 75 balls will be randomly launched in space. Click anywhere on the space to generate an explosion. When a ball hits the fire, it generates another explosion, with same size and strenght of the original one. Have fun playing it. Hint: try to destroy most of the balls with a single click.</p>
	</p>

<h2>License</h2>
<p><a href="http://creativecommons.org/licenses/GPL/2.0/">CC GPL 2.0</a></p>



</div>
</body>
</html>
